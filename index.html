<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Calculadora de Pr√©stamos - Co-sena</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #f7f9fc;
      margin: 0;
      padding: 0;
    }
    .container {
      max-width: 800px;
      margin: 40px auto;
      background: white;
      padding: 30px;
      border-radius: 10px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
      text-align: center;
    }
    .logo {
      width: 120px;
      margin-bottom: 20px;
    }
    h2 {
      margin-bottom: 20px;
    }
    input, button, select {
      width: 100%;
      padding: 12px;
      margin: 10px 0;
      border-radius: 6px;
      border: 1px solid #ddd;
      font-size: 16px;
    }
    button {
      background-color: #0033A0;
      color: white;
      border: none;
      font-weight: bold;
      cursor: pointer;
      transition: 0.3s;
    }
    button:hover {
      background-color: #00267a;
    }
    .nota {
      font-size: 13px;
      color: #555;
      margin-top: -5px;
      margin-bottom: 15px;
      text-align: left;
    }
    .resultados {
      margin-top: 20px;
      font-size: 18px;
      font-weight: bold;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
      font-size: 14px;
    }
    table, th, td {
      border: 1px solid #ddd;
    }
    th {
      background-color: #0033A0;
      color: white;
      padding: 10px;
    }
    td {
      padding: 8px;
      text-align: center;
    }
    tr:nth-child(even) {
      background-color: #f2f2f2;
    }
  </style>
</head>
<body>
  <div class="container">
    <img src="logo-cosena.png" alt="Logo Co-sena" class="logo">

    <h2>Calculadora de Pr√©stamos</h2>

    <label>Fecha de disposici√≥n:</label>
    <input type="date" id="fecha">

    <label>Monto del pr√©stamo:</label>
    <input type="text" id="monto" placeholder="Ejemplo: $ 20.000.000" oninput="formatearNumero(this)">

    <label>Tasa de inter√©s:</label>
    <input type="number" id="tasa" step="0.01" placeholder="Ejemplo: 18">

    <label>Tipo de tasa:</label>
    <select id="tipoTasa">
      <option value="EA">Efectiva Anual (EA)</option>
      <option value="NM">Nominal Mensual (NM)</option>
    </select>
    <p class="nota">
      üìå <b>Nota:</b>  
      - <b>EA (Efectiva Anual):</b> es la tasa anual que incluye capitalizaci√≥n, se convierte autom√°ticamente a tasa mensual.  
      - <b>NM (Nominal Mensual):</b> es la tasa fija que se aplica directamente cada mes.  
      ‚ö†Ô∏è Aseg√∫rate de ingresar el valor correcto seg√∫n el tipo que elijas.
    </p>

    <label>Plazo (en meses):</label>
    <input type="number" id="plazo" placeholder="Ejemplo: 24">

    <button onclick="calcular()">Calcular cuota</button>

    <div class="resultados" id="resultados"></div>
    <div id="tabla"></div>
  </div>

  <script>
    function formatearNumero(input) {
      let valor = input.value.replace(/\D/g, "");
      if (valor === "") {
        input.value = "";
        return;
      }
      input.value = "$ " + new Intl.NumberFormat("es-CO").format(valor);
    }

    function calcular() {
      const fechaDisp = document.getElementById("fecha").value;
      let montoTexto = document.getElementById("monto").value.replace(/\D/g, "");
      let monto = montoTexto ? parseFloat(montoTexto) : 0;
      const tasaIngresada = parseFloat(document.getElementById("tasa").value) / 100;
      const tipoTasa = document.getElementById("tipoTasa").value;
      const plazo = parseInt(document.getElementById("plazo").value);

      if (!monto || !tasaIngresada || !plazo || !fechaDisp) {
        alert("Por favor, complete todos los campos.");
        return;
      }

      // Convertir la tasa seg√∫n el tipo
      let i_m;
      if (tipoTasa === "EA") {
        i_m = Math.pow(1 + tasaIngresada, 1 / 12) - 1;
      } else {
        i_m = tasaIngresada;
      }

      // Calcular la cuota mensual sin seguro
      const cuota = monto * (i_m / (1 - Math.pow(1 + i_m, -plazo)));

      // Seguro de vida: $1.290 por mill√≥n
      const seguroMensual = (monto / 1000000) * 1290;
      const cuotaConSeguro = cuota + seguroMensual;

      let saldo = monto;
      let tabla = `
        <table>
          <tr>
            <th>No.</th>
            <th>Fecha</th>
            <th>Saldo inicial</th>
            <th>Inter√©s</th>
            <th>Abono a capital</th>
            <th>Cuota (sin seguro)</th>
            <th>Seguro</th>
            <th>Cuota total</th>
            <th>Saldo final</th>
          </tr>
      `;

      let totalIntereses = 0;
      let fecha = new Date(fechaDisp);
      const formato = new Intl.NumberFormat("es-CO", { minimumFractionDigits: 2, maximumFractionDigits: 2 });

      for (let n = 1; n <= plazo; n++) {
        let interes = saldo * i_m;
        let abonoCapital = cuota - interes;
        let saldoFinal = saldo - abonoCapital;

        totalIntereses += interes;

        fecha.setMonth(fecha.getMonth() + 1);
        const dia = String(fecha.getDate()).padStart(2, '0');
        const mes = String(fecha.getMonth() + 1).padStart(2, '0');
        const anio = fecha.getFullYear();
        const fechaPago = `${dia}/${mes}/${anio}`;

        tabla += `
          <tr>
            <td>${n}</td>
            <td>${fechaPago}</td>
            <td>$ ${formato.format(saldo)}</td>
            <td>$ ${formato.format(interes)}</td>
            <td>$ ${formato.format(abonoCapital)}</td>
            <td>$ ${formato.format(cuota)}</td>
            <td>$ ${formato.format(seguroMensual)}</td>
            <td>$ ${formato.format(cuotaConSeguro)}</td>
            <td>$ ${formato.format(saldoFinal)}</td>
          </tr>
        `;

        saldo = saldoFinal;
      }

      tabla += "</table>";

      document.getElementById("resultados").innerHTML = `
        üìå Cuota sin seguro: $ ${formato.format(cuota)}<br>
        üõ°Ô∏è Seguro mensual: $ ${formato.format(seguroMensual)}<br>
        ‚úÖ Cuota total con seguro: $ ${formato.format(cuotaConSeguro)}<br><br>
        Total a pagar (con seguro): $ ${formato.format(cuotaConSeguro * plazo)}<br>
        Intereses a pagar: $ ${formato.format(totalIntereses)}
      `;

      document.getElementById("tabla").innerHTML = tabla;
    }
  </script>
</body>
</html>
